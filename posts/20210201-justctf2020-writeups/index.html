<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>justCTF[*]2020 - debug_me_if_you_can, REmap writeups - Midas Blog</title><meta name="Description" content="Writeups for justCTF[*]2020 reversing challenges"><meta property="og:title" content="justCTF[*]2020 - debug_me_if_you_can, REmap writeups" />
<meta property="og:description" content="Writeups for justCTF[*]2020 reversing challenges" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lkmidas.github.io/posts/20210201-justctf2020-writeups/" /><meta property="og:image" content="https://lkmidas.github.io/images/avatar.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-01T10:03:59+07:00" />
<meta property="article:modified_time" content="2021-02-01T10:03:59+07:00" /><meta property="og:site_name" content="My cool site" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://lkmidas.github.io/images/avatar.png"/>

<meta name="twitter:title" content="justCTF[*]2020 - debug_me_if_you_can, REmap writeups"/>
<meta name="twitter:description" content="Writeups for justCTF[*]2020 reversing challenges"/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://lkmidas.github.io/posts/20210201-justctf2020-writeups/" /><link rel="prev" href="https://lkmidas.github.io/posts/20210128-linux-kernel-pwn-part-2/" /><link rel="next" href="https://lkmidas.github.io/posts/20210205-linux-kernel-pwn-part-3/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "justCTF[*]2020 - debug_me_if_you_can, REmap writeups",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/lkmidas.github.io\/posts\/20210201-justctf2020-writeups\/"
        },"genre": "posts","wordcount":  3344 ,
        "url": "https:\/\/lkmidas.github.io\/posts\/20210201-justctf2020-writeups\/","datePublished": "2021-02-01T10:03:59+07:00","dateModified": "2021-02-01T10:03:59+07:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Midas"
            },"description": "Writeups for justCTF[*]2020 reversing challenges"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Midas Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/avatar.png"
        data-srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x"
        data-sizes="auto"
        alt="/images/avatar.png"
        title="/images/avatar.png" /></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Midas Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/avatar.png"
        data-srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x"
        data-sizes="auto"
        alt="/images/avatar.png"
        title="/images/avatar.png" /></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">justCTF[*]2020 - debug_me_if_you_can, REmap writeups</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Midas</a></span>&nbsp;<span class="post-category">included in <a href="/categories/writeups/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>writeups</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2021-02-01">2021-02-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;3344 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;16 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#debug_me_if_you_can">debug_me_if_you_can</a>
      <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#analyze-the-supervisor">Analyze the supervisor</a></li>
        <li><a href="#analyze-the-parent-process">Analyze the parent process</a></li>
        <li><a href="#hooking-ptrace-with-ld_preload">Hooking ptrace with LD_PRELOAD</a></li>
        <li><a href="#analyze-the-child-process">Analyze the child process</a></li>
        <li><a href="#calculating-the-correct-key">Calculating the correct key</a></li>
        <li><a href="#appendix">Appendix</a></li>
      </ul>
    </li>
    <li><a href="#remap">REmap</a>
      <ul>
        <li><a href="#introduction-1">Introduction</a></li>
        <li><a href="#extracting-the-executable">Extracting the executable</a></li>
        <li><a href="#remapping-the-python-opcodes">Remapping the python opcodes</a></li>
        <li><a href="#converting-modified-code-back">Converting modified code back</a></li>
        <li><a href="#analyzing-decompiled-python-code">Analyzing decompiled python code</a></li>
        <li><a href="#appendix-1">Appendix</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><em>Use the table of contents on the right to navigate to the challenge that you are interested in.</em></div>
        </div>
    </div>
<hr>
<h2 id="debug_me_if_you_can">debug_me_if_you_can</h2>
<h3 id="introduction">Introduction</h3>
<div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-info-circle fa-fw" aria-hidden="true"></i>Challenge Info<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li><strong>Given files:</strong> <a href="/posts/20210201-justctf2020-writeups/debug_me/supervisor" rel="">supervisor</a>, <a href="/posts/20210201-justctf2020-writeups/debug_me/crackme.enc" rel="">crackme.enc</a>, <a href="/posts/20210201-justctf2020-writeups/debug_me/flag.png.enc" rel="">flag.png.enc</a>.</li>
<li><strong>Description:</strong> <code>I bet you can't crack this binary protected with my custom bl33d1ng edg3 pr0t3c70r!!!111oneoneone</code></li>
<li><strong>Category:</strong> Reverse engineering</li>
<li><strong>Summary:</strong> An anti-debug type challenge, with a process forks a child then monitors it with <code>ptrace()</code>. The child process is encrypted, and only being decoded to execution after sending debug trap to the parent. Our job is to find out what the child does to decrypt the encrypted flag image.</li>
</ul>
</div>
        </div>
    </div>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>TL;DR<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ol>
<li>Analyze <a href="/posts/20210201-justctf2020-writeups/debug_me/supervisor" rel="">supervisor</a> -&gt; Learn that it forks a child process which executes <a href="/posts/20210201-justctf2020-writeups/debug_me/crackme.enc" rel="">crackme.enc</a> and monitors it with <code>ptrace()</code>.</li>
<li>Analyze the parent process -&gt; Learn that it catches debug break and modifies the code of its child on the fly.</li>
<li>Use <code>LD_PRELOAD</code> hooking technique to see what code is being modified in the child -&gt; Patch it accordingly.</li>
<li>Analyze the child process -&gt; Learn that it checks <code>secret_key</code> by simple math and comparison.</li>
<li>Write code to generate correct key -&gt; get flag.</li>
</ol>
</div>
        </div>
    </div>
<h3 id="analyze-the-supervisor">Analyze the supervisor</h3>
<p>The <a href="/posts/20210201-justctf2020-writeups/debug_me/supervisor" rel="">supervisor</a> seems like a good place to start, so I started looking at it first. It is clear that it initializes a lot of data, then <code>fork()</code> a child process. The child process will then make a call to <code>ptrace()</code> with <code>PTRACE_TRACEME</code>, then execute <a href="/posts/20210201-justctf2020-writeups/debug_me/crackme.enc" rel="">crackme.enc</a> via <code>execl</code>. To this point, I already knew that this is a <code>Nanomites</code> type challenge that makes it hard for us to debug the child process, which is where all the main logics are.</p>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>Tip<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><em>Nanomites is an anti-debug software protection technique. Resource for further information: <a href="https://malwareandstuff.com/nanomites-on-linux/" target="_blank" rel="noopener noreffer ">Nanomites on Linux</a></em></div>
        </div>
    </div>
<h3 id="analyze-the-parent-process">Analyze the parent process</h3>
<p>The parent process is interacting with its child by catching debug break <code>0xCC</code>, then modify its code to execute. I didn&rsquo;t reverse engineer the whole part of how it modifies the child process, I only tried to have a high-level overview of what&rsquo;s going on. The reason is that I already thought of using the <code>LD_PRELOAD</code> hooking technique that is super useful against <code>Nanomites</code>. In short, this is what the parent does:</p>
<ol>
<li>Catch debug break <code>0xCC</code>.</li>
<li>Check if the next 4 bytes are <code>0x1337BABE</code>.</li>
<li>Look for the first 4 bytes of <code>0xFEEDC0DE</code> after that.</li>
<li>Look for the first 4 bytes of <code>0xDEADC0DE</code> after that.</li>
<li>Decrypt the code between the 2 positions in (3) and (4).</li>
<li>Set the child <code>RIP</code> using <code>PTRACE_SETREGS</code>.</li>
<li>At the end of the decrypted code will be another <code>0xCC</code>, therefore it will re-encrypt the code when the function returns.</li>
</ol>
<p>It modifies the child&rsquo;s code by using <code>ptrace()</code> with <code>PTRACE_POKETEXT</code>. The code is decrypted using the data it reads from the child using <code>PTRACE_PEEKTEXT</code> and the data that it initilized back at <code>main()</code>. The data go through a bunch of bitwise operations, which I had no intent to see what it does since I can hook <code>ptrace()</code> and dump these values out.</p>
<h3 id="hooking-ptrace-with-ld_preload">Hooking ptrace with LD_PRELOAD</h3>
<p>This is a well-known technique for dealing with <code>Nanomites</code>, as introduced <a href="https://tbrindus.ca/correct-ld-preload-hooking-libc/" target="_blank" rel="noopener noreffer ">here</a>. Since it is <code>ptrace()</code> with <code>PTRACE_POKETEXT</code> and <code>PTRACE_SETREGS</code> that we are intrested in, I decided to hook exactly those 2:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">long</span> <span class="kt">int</span> <span class="nf">ptrace</span><span class="p">(</span><span class="k">enum</span> <span class="n">__ptrace_request</span> <span class="n">__request</span><span class="p">,</span> <span class="p">...){</span>
</span></span><span class="line"><span class="cl">    <span class="kt">pid_t</span> <span class="n">caller</span> <span class="o">=</span> <span class="nf">getpid</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">va_list</span> <span class="n">list</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">va_start</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">__request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">pid_t</span> <span class="n">pid</span> <span class="o">=</span> <span class="nf">va_arg</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="kt">pid_t</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span><span class="o">*</span> <span class="n">addr</span> <span class="o">=</span> <span class="nf">va_arg</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="nf">va_arg</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">orig_ptrace</span><span class="p">)(</span><span class="k">enum</span> <span class="n">__ptrace_request</span> <span class="n">__request</span><span class="p">,</span> <span class="kt">pid_t</span> <span class="n">pid</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">orig_ptrace</span> <span class="o">=</span> <span class="nf">dlsym</span><span class="p">(</span><span class="n">RTLD_NEXT</span><span class="p">,</span> <span class="s">&#34;ptrace&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="nf">orig_ptrace</span><span class="p">(</span><span class="n">__request</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">__request</span> <span class="o">==</span> <span class="n">PTRACE_SETREGS</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rip</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="o">*</span><span class="p">)</span><span class="n">data</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x555555554000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;SETREGS: rip: 0x%lx</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">rip</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">__request</span> <span class="o">==</span> <span class="n">PTRACE_POKETEXT</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;POKETEXT: (addr , data) = (0x%lx , 0x%lx)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">addr</span> <span class="o">-</span> <span class="mh">0x555555554000</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Compile the lib:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gcc -shared -fPIC ptrace_hook.c -ldl -o ptrace_hook.so
</span></span></code></pre></div><p>I then wrote a short <code>python</code> script to run the binary using <code>pwntools</code>. The reason I used <code>pwntools</code> is to easily disable <code>ASLR</code>, so that I can calculate the offset to the modified code by simply subtracting <code>0x555555554000</code> (as seen in the code above):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&#34;./supervisor&#34;</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;LD_PRELOAD&#34;</span><span class="p">:</span><span class="s2">&#34;./ptrace_hook.so&#34;</span><span class="p">},</span> <span class="n">aslr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Here is what I initially got:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POKETEXT: <span class="o">(</span>addr , data<span class="o">)</span> <span class="o">=</span> <span class="o">(</span>0x1800 , 0x45c748fffff84be8<span class="o">)</span>
</span></span><span class="line"><span class="cl">POKETEXT: <span class="o">(</span>addr , data<span class="o">)</span> <span class="o">=</span> <span class="o">(</span>0x1871 , 0x89e0458b48000000<span class="o">)</span>
</span></span><span class="line"><span class="cl">POKETEXT: <span class="o">(</span>addr , data<span class="o">)</span> <span class="o">=</span> <span class="o">(</span>0x18e5 , 0x1ebfffff7b5e8c7<span class="o">)</span>
</span></span><span class="line"><span class="cl">POKETEXT: <span class="o">(</span>addr , data<span class="o">)</span> <span class="o">=</span> <span class="o">(</span>0x1838 , 0x8948d8458b48c289<span class="o">)</span>
</span></span><span class="line"><span class="cl">POKETEXT: <span class="o">(</span>addr , data<span class="o">)</span> <span class="o">=</span> <span class="o">(</span>0x18a8 , 0x775fff883fffffd<span class="o">)</span>
</span></span><span class="line"><span class="cl">SETREGS: rip: 0x17f9
</span></span><span class="line"><span class="cl">Hello there!
</span></span><span class="line"><span class="cl">POKETEXT: <span class="o">(</span>addr , data<span class="o">)</span> <span class="o">=</span> <span class="o">(</span>0x16db , 0xe8c78948000009ab<span class="o">)</span>
</span></span><span class="line"><span class="cl">POKETEXT: <span class="o">(</span>addr , data<span class="o">)</span> <span class="o">=</span> <span class="o">(</span>0x174b , 0x8348008b48d8458b<span class="o">)</span>
</span></span><span class="line"><span class="cl">POKETEXT: <span class="o">(</span>addr , data<span class="o">)</span> <span class="o">=</span> <span class="o">(</span>0x17bd , 0x1ebfffff93de8c7<span class="o">)</span>
</span></span><span class="line"><span class="cl">POKETEXT: <span class="o">(</span>addr , data<span class="o">)</span> <span class="o">=</span> <span class="o">(</span>0x1712 , 0xe8c7894800000000<span class="o">)</span>
</span></span><span class="line"><span class="cl">POKETEXT: <span class="o">(</span>addr , data<span class="o">)</span> <span class="o">=</span> <span class="o">(</span>0x1781 , 0xf975e8c78948f845<span class="o">)</span>
</span></span><span class="line"><span class="cl">SETREGS: rip: 0x16d4
</span></span><span class="line"><span class="cl">Error! https://www.youtube.com/watch?v<span class="o">=</span>Khk6SEQ-K-k
</span></span><span class="line"><span class="cl">0xCCya!
</span></span></code></pre></div><p>We can see that there are 2 code blocks that are being modified by running it like this, let&rsquo;s investigate the child process further.</p>
<h3 id="analyze-the-child-process">Analyze the child process</h3>
<p>First thing I do is to write a simple <code>IDA</code> script to patch the child&rsquo;s memory (I know my code is ugly, but it&rsquo;s just for CTF and it works):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">ida_bytes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">patches_1</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mh">0x1800</span> <span class="p">,</span> <span class="mh">0x45c748fffff84be8</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mh">0x1871</span> <span class="p">,</span> <span class="mh">0x89e0458b48000000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mh">0x18e5</span> <span class="p">,</span> <span class="mh">0x1ebfffff7b5e8c7</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mh">0x1838</span> <span class="p">,</span> <span class="mh">0x8948d8458b48c289</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mh">0x18a8</span> <span class="p">,</span> <span class="mh">0x775fff883fffffd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">patches_2</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mh">0x16db</span> <span class="p">,</span> <span class="mh">0xe8c78948000009ab</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mh">0x174b</span> <span class="p">,</span> <span class="mh">0x8348008b48d8458b</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mh">0x17bd</span> <span class="p">,</span> <span class="mh">0x1ebfffff93de8c7</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mh">0x1712</span> <span class="p">,</span> <span class="mh">0xe8c7894800000000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mh">0x1781</span> <span class="p">,</span> <span class="mh">0xf975e8c78948f845</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Patch the irrelevant 0xCC bytes</span>
</span></span><span class="line"><span class="cl"><span class="n">rip</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x17f9</span><span class="p">,</span> <span class="mh">0x16d4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">CC</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x17dc</span><span class="p">,</span> <span class="mh">0x16b7</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rip</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ida_bytes</span><span class="o">.</span><span class="n">patch_bytes</span><span class="p">(</span><span class="n">CC</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x90</span><span class="s1">&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">rip</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">CC</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Patch the encrypted bytes</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="n">patches</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">        <span class="n">ida_bytes</span><span class="o">.</span><span class="n">patch_qword</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">patch</span><span class="p">(</span><span class="n">patches_1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">patch</span><span class="p">(</span><span class="n">patches_2</span><span class="p">)</span>
</span></span></code></pre></div><p>One thing to note here is that I also patched the part from the <code>0xCC</code> to where the child&rsquo;s <code>RIP</code> is set to <code>NOPs</code>, this helps IDA decompiler from stucking at <code>__debugbreak()</code>.</p>
<p>After patching and decompiling, it can be easily seen that the process tries to read from a file named <code>secret_key</code>. I didn&rsquo;t have that file yet, that&rsquo;s why it only decrypts 2 short blocks of code. Adding a file named <code>secret_key</code> with some dummy contents inside, then re-running the program will reveal more code blocks that are decrypted. Simply applying the exact same patching strategy as above, I could construct the full checking routine in the child (check the full patching code at <a href="/posts/20210201-justctf2020-writeups/debug_me/patch.py" rel="">patch.py</a>).</p>
<div class="details admonition warning open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden="true"></i>Warning<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><em>As I have mentioned above, when each decrypted code block returns, the parent will try to re-encrypt the code. Therefore, we only need to apply the patch for the FIRST appearance of each address, and ignore all the subsequent ones.</em></div>
        </div>
    </div>
<h3 id="calculating-the-correct-key">Calculating the correct key</h3>
<p>The function for checking the key:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">check_key</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">key</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// eax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+1Fh] [rbp-11h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-10h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+24h] [rbp-Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">index</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">correct</span><span class="p">;</span> <span class="c1">// [rsp+2Ch] [rbp-4h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">correct</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0x7F</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">j</span> <span class="o">=</span> <span class="nf">calculate</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="n">size</span> <span class="o">&lt;=</span> <span class="n">index</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">correct</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">goto</span> <span class="n">LABEL_13</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">v2</span> <span class="o">=</span> <span class="n">index</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">v4</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v2</span> <span class="o">+</span> <span class="n">key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="nf">compare_char</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">v4</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">j</span> <span class="o">=</span> <span class="nf">calculate</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="nf">compare_char</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">v4</span><span class="p">,</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="nf">compare_char</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">v4</span><span class="p">,</span> <span class="sc">&#39;?&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">ARR</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">correct</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">correct</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nl">LABEL_13</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">correct</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">size</span> <span class="o">!=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">correct</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">correct</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Fortunately, the checking is not that complicated. What it does is by iterating <code>i</code> from 1 to 127 in the outer loop, then iterate through each of the characters in our <code>secret_key</code> file. The variable <code>j</code> starts from 0, then for each character <code>0</code> in our key, we have <code>j = 2*j + 1</code>, and for each character <code>1</code>, we have <code>j = j*2 + 2</code>. Finally, when it reaches the character <code>?</code>, it checks in a constant array <code>ARR</code> to see if <code>ARR[j] == i</code>. So essentially, we have to write a key which contains 128 small blocks of 0s and 1s that calculate the correct index <code>j</code> in <code>ARR</code> where each <code>i</code> appears.</p>
<p>The algorithm to calculate the key for any number <code>j</code> is by simply starting from <code>j</code> then iterates back to 0:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_key</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">key</span> <span class="o">+=</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">key</span> <span class="o">+=</span> <span class="s2">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">key</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span></code></pre></div><p>Then we can calculate all <code>j</code> for all <code>i</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">secret_key</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">ARR</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">secret_key</span> <span class="o">+=</span> <span class="n">get_key</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span>
</span></span></code></pre></div><p>However, using the <code>secret_key</code> above still yields incorrect result. This is the weirdest part of the challenge, looking back at the checking code, we can see one more comparison at the end: <code>size != index + 1</code>. This means there is one more character at the end of the key. I suspected that character would be a null <code>\0</code> or a line break <code>\n</code> and tried them both out. The line break <code>\n</code> gave me the correct key, the program then simply decrypts <code>flag.png.enc</code> and nicely gives us <code>flag_decoded.png</code>. It is a blessing we don&rsquo;t have to do the patching for the decoding routine, since the key is enough for us to get the flag.</p>
<p>And that was it, <em><strong>first blood for Efiens</strong></em>:</p>
<pre tabindex="0"><code>justCTF{Cr4ckm3s_are_0xCCiting}
</code></pre><h3 id="appendix">Appendix</h3>
<p>The source for <code>ptrace()</code> hooking library is <a href="/posts/20210201-justctf2020-writeups/debug_me/ptrace_hook.c" rel="">ptrace_hook.c</a>.</p>
<p>The script to run with <code>LD_PRELOAD</code> is <a href="/posts/20210201-justctf2020-writeups/debug_me/run.py" rel="">run.py</a>.</p>
<p>The script to patch the child is <a href="/posts/20210201-justctf2020-writeups/debug_me/patch.py" rel="">patch.py</a>.</p>
<p>The script to calculate the key is <a href="/posts/20210201-justctf2020-writeups/debug_me/a.py" rel="">a.py</a>.</p>
<hr>
<h2 id="remap">REmap</h2>
<h3 id="introduction-1">Introduction</h3>
<div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-info-circle fa-fw" aria-hidden="true"></i>Challenge Info<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li><strong>Given files:</strong> <a href="/posts/20210201-justctf2020-writeups/REmap/backup_decryptor.exe" rel="">backup_decryptor.exe</a>.</li>
<li><strong>Description:</strong> <code>Recently we fired our admin responsible for backups. We have the program he wrote to decrypt those backups, but apparently it's password protected. He did not leave any passwords and he's not answering his phone. Help us crack this password!</code></li>
<li><strong>Category:</strong> Reverse engineering</li>
<li><strong>Summary:</strong> The executable given in this challenge is generated using <code>PyInstaller</code>. However, the python interpreter of it is a modified version with all opcodes shuffled together. Our goal is to first find a way to remap the new opcodes to the old ones so as to successfully decompile the python compiled code.</li>
</ul>
</div>
        </div>
    </div>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>TL;DR<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ol>
<li>Extrace <code>PyInstaller</code> packed executable with <a href="https://github.com/extremecoders-re/pyinstxtractor" target="_blank" rel="noopener noreffer ">pyinstxtractor.py</a> -&gt; See entry point at <code>backup_decryptor.pyc</code>.</li>
<li>Try to decompile/disassemble it -&gt; Fail because of invalid arg count.</li>
<li>Recognize that it has remapped all the python opcodes -&gt; Find a way to find the mapping back to the original.</li>
<li>Write code to convert the mapped <code>pyc</code> to the original -&gt; Decompile it.</li>
<li>Analyze the decompiled python code -&gt; Get flag.</li>
</ol>
</div>
        </div>
    </div>
<h3 id="extracting-the-executable">Extracting the executable</h3>
<p>Initially, I threw the executable into IDA, it&rsquo;s a huge binary, and I saw an interesting string <code>_MEIPASS2</code>. Googling this string reveals that this is an exe generated by <a href="https://www.pyinstaller.org/" target="_blank" rel="noopener noreffer ">PyInstaller</a>, which is generated from python code. An easy way to extract this is to use the <a href="https://github.com/extremecoders-re/pyinstxtractor" target="_blank" rel="noopener noreffer ">pyinstxtractor.py</a>, here is the result:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Processing backup_decryptor.exe
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Pyinstaller version: 2.1+
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Python version: <span class="m">38</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Length of package: <span class="m">5598412</span> bytes
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Found <span class="m">31</span> files in CArchive
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Beginning extraction...please standby
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Possible entry point: pyiboot01_bootstrap.pyc
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Possible entry point: pyi_rth_multiprocessing.pyc
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Possible entry point: backup_decryptor.pyc
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Found <span class="m">222</span> files in PYZ archive
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Successfully extracted pyinstaller archive: backup_decryptor.exe
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">You can now use a python decompiler on the pyc files within the extracted directory
</span></span></code></pre></div><p>As you can see, it extracts the executable into a folder, which contains the python interpreter <code>python38.dll</code> itself, and a bunch of python compiled code <code>pyc</code> files. Out of the 3 possible entry points that it found, it is almost 100% sure that the real entry point is <code>backup_decryptor.pyc</code>. Since <code>pyc</code> files are just python bytecodes, we need a way to decompile/disassemble them. I tried out the 2 popular python decompiler, which are <a href="https://pypi.org/project/uncompyle6/" target="_blank" rel="noopener noreffer ">uncompyle6</a> and <a href="https://github.com/rocky/python-decompile3" target="_blank" rel="noopener noreffer ">decompyle3</a>, but both of them didn&rsquo;t succeed in doing so. I struggling for a while, then decided to disassemble it first instead of decompiling using python&rsquo;s built-in <code>dis</code> package, but it fails as well! All the failure was due to invalid argument count for an opcode. I actually got frustrated a lot and tried out a lot of different methods to decompile it, but all fails.</p>
<h3 id="remapping-the-python-opcodes">Remapping the python opcodes</h3>
<p>A while after, I decided to open the <code>pyc</code> file in a hex editor, and compare it with a normal test <code>pyc</code> generated by myself. What I found is that the first few opcodes of the 2 are different (typically the first few opcodes of all <code>pyc</code> files are the same). Looking back at the challenge&rsquo;s name, I finally recognized that this python interpreter is a custom one, and the opcodes value have been shuffled around. This is a kinda well-known technique to obfuscate python executables, as explained quite detailed <a href="https://medium.com/tenable-techblog/remapping-python-opcodes-67d79586bfd5" target="_blank" rel="noopener noreffer ">here</a>. So the goal now is to find a mapping back to the original opcodes from the modified ones, there are 3 approaches that I had thought of:</p>
<ol>
<li>Copy the modified <code>python38.dll</code> interpreter into my own python folder and run it, then use the <code>opcode</code> package to get the info.</li>
<li>Diffing the modified interpreter with the original one to find out the different opcodes.</li>
<li>Using all the extracted <code>pyc</code> files and try to look for a way to map back from there.</li>
</ol>
<p>For (1), I have no idea how to run with the modified <code>python38.dll</code>, my python crashes everytime I tried to do it, so it was a fail. For (2), I&rsquo;m a noob and not used to binary diffing, so I had no idea how to do it. Therefore, I had to resort to option (3), which is kind of a pain. What I did was to investigate the <code>opcode.pyc</code> file in the extracted folder that I renamed to <code>opcode_mapped.pyc</code>, and a compiled version of the original <code>opcode.py</code>, which I named <code>opcode_orig.pyc</code>. I found out that most of the opcodes are saved as constants in the file, in a contiguous array in the form of: <code>name1 -&gt; opcode1 -&gt; name2 -&gt; opcode2 -&gt; ...</code>. Therefore, I wrote a short piece of code to parse them out:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">orig</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;POP_TOP&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ROT_TWO&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;ROT_THREE&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;DUP_TOP&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;DUP_TOP_TWO&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;ROT_FOUR&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;NOP&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;UNARY_POSITIVE&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;UNARY_NEGATIVE&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;UNARY_NOT&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;UNARY_INVERT&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;BINARY_MATRIX_MULTIPLY&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;INPLACE_MATRIX_MULTIPLY&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="s1">&#39;BINARY_POWER&#39;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span> <span class="s1">&#39;BINARY_MULTIPLY&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;BINARY_MODULO&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">&#39;BINARY_ADD&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;BINARY_SUBTRACT&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;BINARY_SUBSCR&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;BINARY_FLOOR_DIVIDE&#39;</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span> <span class="s1">&#39;BINARY_TRUE_DIVIDE&#39;</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span> <span class="s1">&#39;INPLACE_FLOOR_DIVIDE&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="s1">&#39;INPLACE_TRUE_DIVIDE&#39;</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span> <span class="s1">&#39;GET_AITER&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;GET_ANEXT&#39;</span><span class="p">:</span> <span class="mi">51</span><span class="p">,</span> <span class="s1">&#39;BEFORE_ASYNC_WITH&#39;</span><span class="p">:</span> <span class="mi">52</span><span class="p">,</span> <span class="s1">&#39;BEGIN_FINALLY&#39;</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span> <span class="s1">&#39;END_ASYNC_FOR&#39;</span><span class="p">:</span> <span class="mi">54</span><span class="p">,</span> <span class="s1">&#39;INPLACE_ADD&#39;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;INPLACE_SUBTRACT&#39;</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span> <span class="s1">&#39;INPLACE_MULTIPLY&#39;</span><span class="p">:</span> <span class="mi">57</span><span class="p">,</span> <span class="s1">&#39;INPLACE_MODULO&#39;</span><span class="p">:</span> <span class="mi">59</span><span class="p">,</span> <span class="s1">&#39;STORE_SUBSCR&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;DELETE_SUBSCR&#39;</span><span class="p">:</span> <span class="mi">61</span><span class="p">,</span> <span class="s1">&#39;BINARY_LSHIFT&#39;</span><span class="p">:</span> <span class="mi">62</span><span class="p">,</span> <span class="s1">&#39;BINARY_RSHIFT&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span> <span class="s1">&#39;BINARY_AND&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;BINARY_XOR&#39;</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span> <span class="s1">&#39;BINARY_OR&#39;</span><span class="p">:</span> <span class="mi">66</span><span class="p">,</span> <span class="s1">&#39;INPLACE_POWER&#39;</span><span class="p">:</span> <span class="mi">67</span><span class="p">,</span> <span class="s1">&#39;GET_ITER&#39;</span><span class="p">:</span> <span class="mi">68</span><span class="p">,</span> <span class="s1">&#39;GET_YIELD_FROM_ITER&#39;</span><span class="p">:</span> <span class="mi">69</span><span class="p">,</span> <span class="s1">&#39;PRINT_EXPR&#39;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span> <span class="s1">&#39;LOAD_BUILD_CLASS&#39;</span><span class="p">:</span> <span class="mi">71</span><span class="p">,</span> <span class="s1">&#39;YIELD_FROM&#39;</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span> <span class="s1">&#39;GET_AWAITABLE&#39;</span><span class="p">:</span> <span class="mi">73</span><span class="p">,</span> <span class="s1">&#39;INPLACE_LSHIFT&#39;</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span> <span class="s1">&#39;INPLACE_RSHIFT&#39;</span><span class="p">:</span> <span class="mi">76</span><span class="p">,</span> <span class="s1">&#39;INPLACE_AND&#39;</span><span class="p">:</span> <span class="mi">77</span><span class="p">,</span> <span class="s1">&#39;INPLACE_XOR&#39;</span><span class="p">:</span> <span class="mi">78</span><span class="p">,</span> <span class="s1">&#39;INPLACE_OR&#39;</span><span class="p">:</span> <span class="mi">79</span><span class="p">,</span> <span class="s1">&#39;WITH_CLEANUP_START&#39;</span><span class="p">:</span> <span class="mi">81</span><span class="p">,</span> <span class="s1">&#39;WITH_CLEANUP_FINISH&#39;</span><span class="p">:</span> <span class="mi">82</span><span class="p">,</span> <span class="s1">&#39;RETURN_VALUE&#39;</span><span class="p">:</span> <span class="mi">83</span><span class="p">,</span> <span class="s1">&#39;IMPORT_STAR&#39;</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span> <span class="s1">&#39;SETUP_ANNOTATIONS&#39;</span><span class="p">:</span> <span class="mi">85</span><span class="p">,</span> <span class="s1">&#39;YIELD_VALUE&#39;</span><span class="p">:</span> <span class="mi">86</span><span class="p">,</span> <span class="s1">&#39;POP_BLOCK&#39;</span><span class="p">:</span> <span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;END_FINALLY&#39;</span><span class="p">:</span> <span class="mi">88</span><span class="p">,</span> <span class="s1">&#39;POP_EXCEPT&#39;</span><span class="p">:</span> <span class="mi">89</span><span class="p">,</span> <span class="s1">&#39;STORE_NAME&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;DELETE_NAME&#39;</span><span class="p">:</span> <span class="mi">91</span><span class="p">,</span> <span class="s1">&#39;UNPACK_SEQUENCE&#39;</span><span class="p">:</span> <span class="mi">92</span><span class="p">,</span> <span class="s1">&#39;FOR_ITER&#39;</span><span class="p">:</span> <span class="mi">93</span><span class="p">,</span> <span class="s1">&#39;UNPACK_EX&#39;</span><span class="p">:</span> <span class="mi">94</span><span class="p">,</span> <span class="s1">&#39;STORE_ATTR&#39;</span><span class="p">:</span> <span class="mi">95</span><span class="p">,</span> <span class="s1">&#39;DELETE_ATTR&#39;</span><span class="p">:</span> <span class="mi">96</span><span class="p">,</span> <span class="s1">&#39;STORE_GLOBAL&#39;</span><span class="p">:</span> <span class="mi">97</span><span class="p">,</span> <span class="s1">&#39;DELETE_GLOBAL&#39;</span><span class="p">:</span> <span class="mi">98</span><span class="p">,</span> <span class="s1">&#39;LOAD_CONST&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;LOAD_NAME&#39;</span><span class="p">:</span> <span class="mi">101</span><span class="p">,</span> <span class="s1">&#39;BUILD_TUPLE&#39;</span><span class="p">:</span> <span class="mi">102</span><span class="p">,</span> <span class="s1">&#39;BUILD_LIST&#39;</span><span class="p">:</span> <span class="mi">103</span><span class="p">,</span> <span class="s1">&#39;BUILD_SET&#39;</span><span class="p">:</span> <span class="mi">104</span><span class="p">,</span> <span class="s1">&#39;BUILD_MAP&#39;</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span> <span class="s1">&#39;LOAD_ATTR&#39;</span><span class="p">:</span> <span class="mi">106</span><span class="p">,</span> <span class="s1">&#39;COMPARE_OP&#39;</span><span class="p">:</span> <span class="mi">107</span><span class="p">,</span> <span class="s1">&#39;IMPORT_NAME&#39;</span><span class="p">:</span> <span class="mi">108</span><span class="p">,</span> <span class="s1">&#39;IMPORT_FROM&#39;</span><span class="p">:</span> <span class="mi">109</span><span class="p">,</span> <span class="s1">&#39;JUMP_FORWARD&#39;</span><span class="p">:</span> <span class="mi">110</span><span class="p">,</span> <span class="s1">&#39;JUMP_IF_FALSE_OR_POP&#39;</span><span class="p">:</span> <span class="mi">111</span><span class="p">,</span> <span class="s1">&#39;JUMP_IF_TRUE_OR_POP&#39;</span><span class="p">:</span> <span class="mi">112</span><span class="p">,</span> <span class="s1">&#39;JUMP_ABSOLUTE&#39;</span><span class="p">:</span> <span class="mi">113</span><span class="p">,</span> <span class="s1">&#39;POP_JUMP_IF_FALSE&#39;</span><span class="p">:</span> <span class="mi">114</span><span class="p">,</span> <span class="s1">&#39;POP_JUMP_IF_TRUE&#39;</span><span class="p">:</span> <span class="mi">115</span><span class="p">,</span> <span class="s1">&#39;LOAD_GLOBAL&#39;</span><span class="p">:</span> <span class="mi">116</span><span class="p">,</span> <span class="s1">&#39;SETUP_FINALLY&#39;</span><span class="p">:</span> <span class="mi">122</span><span class="p">,</span> <span class="s1">&#39;LOAD_FAST&#39;</span><span class="p">:</span> <span class="mi">124</span><span class="p">,</span> <span class="s1">&#39;STORE_FAST&#39;</span><span class="p">:</span> <span class="mi">125</span><span class="p">,</span> <span class="s1">&#39;DELETE_FAST&#39;</span><span class="p">:</span> <span class="mi">126</span><span class="p">,</span> <span class="s1">&#39;RAISE_VARARGS&#39;</span><span class="p">:</span> <span class="mi">130</span><span class="p">,</span> <span class="s1">&#39;CALL_FUNCTION&#39;</span><span class="p">:</span> <span class="mi">131</span><span class="p">,</span> <span class="s1">&#39;MAKE_FUNCTION&#39;</span><span class="p">:</span> <span class="mi">132</span><span class="p">,</span> <span class="s1">&#39;BUILD_SLICE&#39;</span><span class="p">:</span> <span class="mi">133</span><span class="p">,</span> <span class="s1">&#39;LOAD_CLOSURE&#39;</span><span class="p">:</span> <span class="mi">135</span><span class="p">,</span> <span class="s1">&#39;LOAD_DEREF&#39;</span><span class="p">:</span> <span class="mi">136</span><span class="p">,</span> <span class="s1">&#39;STORE_DEREF&#39;</span><span class="p">:</span> <span class="mi">137</span><span class="p">,</span> <span class="s1">&#39;DELETE_DEREF&#39;</span><span class="p">:</span> <span class="mi">138</span><span class="p">,</span> <span class="s1">&#39;CALL_FUNCTION_KW&#39;</span><span class="p">:</span> <span class="mi">141</span><span class="p">,</span> <span class="s1">&#39;CALL_FUNCTION_EX&#39;</span><span class="p">:</span> <span class="mi">142</span><span class="p">,</span> <span class="s1">&#39;SETUP_WITH&#39;</span><span class="p">:</span> <span class="mi">143</span><span class="p">,</span> <span class="s1">&#39;LIST_APPEND&#39;</span><span class="p">:</span> <span class="mi">145</span><span class="p">,</span> <span class="s1">&#39;SET_ADD&#39;</span><span class="p">:</span> <span class="mi">146</span><span class="p">,</span> <span class="s1">&#39;MAP_ADD&#39;</span><span class="p">:</span> <span class="mi">147</span><span class="p">,</span> <span class="s1">&#39;LOAD_CLASSDEREF&#39;</span><span class="p">:</span> <span class="mi">148</span><span class="p">,</span> <span class="s1">&#39;EXTENDED_ARG&#39;</span><span class="p">:</span> <span class="mi">144</span><span class="p">,</span> <span class="s1">&#39;BUILD_LIST_UNPACK&#39;</span><span class="p">:</span> <span class="mi">149</span><span class="p">,</span> <span class="s1">&#39;BUILD_MAP_UNPACK&#39;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s1">&#39;BUILD_MAP_UNPACK_WITH_CALL&#39;</span><span class="p">:</span> <span class="mi">151</span><span class="p">,</span> <span class="s1">&#39;BUILD_TUPLE_UNPACK&#39;</span><span class="p">:</span> <span class="mi">152</span><span class="p">,</span> <span class="s1">&#39;BUILD_SET_UNPACK&#39;</span><span class="p">:</span> <span class="mi">153</span><span class="p">,</span> <span class="s1">&#39;SETUP_ASYNC_WITH&#39;</span><span class="p">:</span> <span class="mi">154</span><span class="p">,</span> <span class="s1">&#39;FORMAT_VALUE&#39;</span><span class="p">:</span> <span class="mi">155</span><span class="p">,</span> <span class="s1">&#39;BUILD_CONST_KEY_MAP&#39;</span><span class="p">:</span> <span class="mi">156</span><span class="p">,</span> <span class="s1">&#39;BUILD_STRING&#39;</span><span class="p">:</span> <span class="mi">157</span><span class="p">,</span> <span class="s1">&#39;BUILD_TUPLE_UNPACK_WITH_CALL&#39;</span><span class="p">:</span> <span class="mi">158</span><span class="p">,</span> <span class="s1">&#39;LOAD_METHOD&#39;</span><span class="p">:</span> <span class="mi">160</span><span class="p">,</span> <span class="s1">&#39;CALL_METHOD&#39;</span><span class="p">:</span> <span class="mi">161</span><span class="p">,</span> <span class="s1">&#39;CALL_FINALLY&#39;</span><span class="p">:</span> <span class="mi">162</span><span class="p">,</span> <span class="s1">&#39;POP_FINALLY&#39;</span><span class="p">:</span> <span class="mi">163</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">moded</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./opcode_mapped.pyc&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">modded_opcode_pyc</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">orig</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">off</span> <span class="o">=</span> <span class="n">modded_opcode_pyc</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_opcode</span> <span class="o">=</span> <span class="n">modded_opcode_pyc</span><span class="p">[</span><span class="n">off</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">moded</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_opcode</span>
</span></span><span class="line"><span class="cl">    <span class="n">modded_opcode_pyc</span> <span class="o">=</span> <span class="n">modded_opcode_pyc</span><span class="p">[</span><span class="n">off</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">orig</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">mapping</span><span class="p">[</span><span class="n">moded</span><span class="p">[</span><span class="n">instr</span><span class="p">]]</span> <span class="o">=</span> <span class="n">orig</span><span class="p">[</span><span class="n">instr</span><span class="p">]</span>
</span></span></code></pre></div><p>Running this gave me a mapping that looks decent, so I decided to try using it to convert the <code>pyc</code> back to the original opcodes.</p>
<h3 id="converting-modified-code-back">Converting modified code back</h3>
<p>This conversion requires a bit of knowledge about how python compiled code files are formed. The link I provided above about python opcode remapping did a pretty good job at explaining. Here are a few key points:</p>
<ul>
<li>The <code>pyc</code> file contains a header with magic bytes and timestamp, then after that comes one or more <code>code_object</code>.</li>
<li>Each <code>code_object</code> contains its code in <code>co_code</code>, and its constants in <code>co_consts</code>.</li>
<li>Each <code>code_object.co_consts</code> can contain reference to another <code>code_object</code>, this make conversion a recursive process.</li>
</ul>
<p>So the conversion can be written as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">convert_code</span><span class="p">(</span><span class="n">co_code</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_co_code</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">co_code</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_co_code</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="n">co_code</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">co_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">mapping</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">new_co_code</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">co_code</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">new_co_code</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="n">co_code</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">new_co_code</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">recurse_convert_all</span><span class="p">(</span><span class="n">code_obj</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_co_code</span> <span class="o">=</span> <span class="n">convert_code</span><span class="p">(</span><span class="n">code_obj</span><span class="o">.</span><span class="n">co_code</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_co_consts</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">const</span> <span class="ow">in</span> <span class="n">code_obj</span><span class="o">.</span><span class="n">co_consts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">const</span><span class="p">)</span> <span class="o">==</span> <span class="n">types</span><span class="o">.</span><span class="n">CodeType</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_const</span> <span class="o">=</span> <span class="n">recurse_convert_all</span><span class="p">(</span><span class="n">const</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_co_consts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_const</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_co_consts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">const</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">new_code_obj</span> <span class="o">=</span> <span class="n">code_obj</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">co_code</span><span class="o">=</span><span class="n">new_co_code</span><span class="p">,</span> <span class="n">co_consts</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">new_co_consts</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">new_code_obj</span>
</span></span></code></pre></div><p>Note that in python 3.8, all python opcodes are 2 bytes long, even if it has no operands. That makes converting very easy, since we can just map the opcodes and keep the operands as they are.</p>
<p>Using this code, I successfully converted the main <code>code_object</code> of <code>backup_decryptor.pyc</code>. However, the code sadly still cannot be disassembled. It can be disassembled a lot more than before, but still error at some point due to the same error. I then tried to convert <code>opcode_mapped.pyc</code> back to find if there are any errors in my mapping. Turns out there are some errors: 2 opcodes are not placed in the memory the way I declared above, I simply hard-coded them to correct the issue:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">moded</span><span class="p">[</span><span class="s2">&#34;EXTENDED_ARG&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">109</span>
</span></span><span class="line"><span class="cl"><span class="n">moded</span><span class="p">[</span><span class="s2">&#34;LOAD_METHOD&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span>
</span></span></code></pre></div><p>Then finally I could have a fully-converted file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">final</span> <span class="o">=</span> <span class="n">recurse_convert_all</span><span class="p">(</span><span class="n">code_object</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;backup_decryptor_converted.pyc&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fc</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">fc</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x55\x0d\x0d\x0a</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\0</span><span class="s2">&#34;</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span> <span class="c1"># header</span>
</span></span><span class="line"><span class="cl">    <span class="n">marshal</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">final</span><span class="p">,</span> <span class="n">fc</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="analyzing-decompiled-python-code">Analyzing decompiled python code</h3>
<p>With this clean python compiled code, I could decompile it with <code>decompyle3</code> successfully. The resulting python file is small, but still has a layer of obfuscation.</p>
<p>The obfuscation is not that hard though: all the strings in the file are decrypted from a list of bytes using several bit-wise functions, and all the built-in function calls in the file are retrieved by <code>getattr()</code> from <code>builtins</code>. But since this is python code, we can even ignore how these functions decrypt the strings, and just use <code>print()</code> to print out all the resulting strings. Below is the code after replacing all the decrypted strings and functions:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">builtins</span> <span class="k">as</span> <span class="nn">bi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sc</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">|=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">res</span> <span class="o">==</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Enter password:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;justCTF{&#34;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&#34;}&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ff</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">rrr</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">rrr</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="p">(</span><span class="s2">&#34;b3&#34;</span><span class="p">,</span> <span class="n">ff</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;c1&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rrr</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="p">(</span><span class="s2">&#34;77&#34;</span><span class="p">,</span> <span class="n">ff</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;kl&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rrr</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="p">(</span><span class="s2">&#34;3r&#34;</span><span class="p">,</span> <span class="n">ff</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;_f&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rrr</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="p">(</span><span class="s2">&#34;_r&#34;</span><span class="p">,</span> <span class="n">ff</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;7f&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rrr</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="p">(</span><span class="s2">&#34;3h&#34;</span><span class="p">,</span> <span class="n">ff</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;d0&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rrr</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="p">(</span><span class="s2">&#34;1r&#34;</span><span class="p">,</span> <span class="n">ff</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;_a&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rrr</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="p">(</span><span class="s2">&#34;3_&#34;</span><span class="p">,</span> <span class="n">ff</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span> <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;jk&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rrr</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="p">(</span><span class="s2">&#34;7h&#34;</span><span class="p">,</span> <span class="n">ff</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span> <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;8k&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rrr</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="p">(</span><span class="s2">&#34;15&#34;</span><span class="p">,</span> <span class="n">ff</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span> <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;5b&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rrr</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="p">(</span><span class="s2">&#34;_6&#34;</span><span class="p">,</span> <span class="n">ff</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span> <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;_9&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rrr</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="p">(</span><span class="s2">&#34;uy&#34;</span><span class="p">,</span> <span class="n">ff</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;xd&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rrr</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">rrr</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Even tho the password is correct, fuck you, I removed the rest of the code. You shouldn&#39;t have fire me.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Nope&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Nope&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>The function <code>sc()</code> is just a string comparison, so essentially, all the comparisons will be true if the corresponding part of the flag equals to the first parameter. Concatenating them together gives me the flag:</p>
<pre tabindex="0"><code>justCTF{b3773r_r3h1r3_7h15_6uy}
</code></pre><h3 id="appendix-1">Appendix</h3>
<p>The script to remap python compiled code is <a href="/posts/20210201-justctf2020-writeups/REmap/remap.py" rel="">remap.py</a>.</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-02-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://lkmidas.github.io/posts/20210201-justctf2020-writeups/" data-title="justCTF[*]2020 - debug_me_if_you_can, REmap writeups" data-via="_lkmidas"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://lkmidas.github.io/posts/20210201-justctf2020-writeups/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://lkmidas.github.io/posts/20210201-justctf2020-writeups/" data-title="justCTF[*]2020 - debug_me_if_you_can, REmap writeups"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://lkmidas.github.io/posts/20210201-justctf2020-writeups/" data-title="justCTF[*]2020 - debug_me_if_you_can, REmap writeups"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://lkmidas.github.io/posts/20210201-justctf2020-writeups/" data-title="justCTF[*]2020 - debug_me_if_you_can, REmap writeups"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/20210128-linux-kernel-pwn-part-2/" class="prev" rel="prev" title="Learning Linux Kernel Exploitation - Part 2"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Learning Linux Kernel Exploitation - Part 2</a>
            <a href="/posts/20210205-linux-kernel-pwn-part-3/" class="next" rel="next" title="Learning Linux Kernel Exploitation - Part 3">Learning Linux Kernel Exploitation - Part 3<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.110.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":60},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-HGQHGNF9HJ');
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-HGQHGNF9HJ" async></script></body>
</html>
